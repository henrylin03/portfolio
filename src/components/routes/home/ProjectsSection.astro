---
import type { ProjectPreview } from "@/data/projects";
import { Image } from "astro:assets";

interface Props {
  projects: ProjectPreview[];
}

const { projects }: Props = Astro.props;
---

<section class="px-10 pt-24 lg:pt-0 lg:pb-100 xl:px-20 2xl:px-48" id="projects">
  <h2
    class="mb-8 text-right text-4xl sm:text-5xl sm:font-light md:text-8xl lg:mr-24 2xl:mb-0"
  >
    Projects
  </h2>
  <ul class="flex flex-col gap-24 lg:grid lg:grid-cols-2 lg:gap-6 xl:gap-8">
    {
      projects.map((p, idx: number) => (
        <li
          class:list={[
            "flex flex-col items-start gap-4",
            idx % 2 && "lg:translate-y-48 2xl:translate-y-88",
          ]}
        >
          <div class="mockup-browser w-full border border-gray-400">
            <div class="mockup-browser-toolbar">
              <div class="input">{p.buttonForLiveSite.href}</div>
            </div>
            <div class="preview-container grid cursor-pointer place-content-center border-t border-base-300">
              <Image src={p.preview.img} alt="Preview" />
              <video autoplay muted loop playsinline class="hidden">
                <source src={p.preview.video} type="video/mp4" />
              </video>
            </div>
          </div>
          <h3 class="mt-4 text-3xl md:text-4xl lg:mb-2 lg:text-5xl lg:font-light">
            {p.title}
          </h3>
          <div class="grid grid-cols-2 gap-2">
            <a
              role="button"
              class="btn rounded-4xl btn-primary lg:btn-lg"
              href={p.buttonForLiveSite.href}
              target="_blank"
            >
              {p.buttonForLiveSite.copy}
            </a>
            {p.buttonForCodebase && (
              <a
                role="button"
                class="btn rounded-4xl btn-outline btn-primary lg:btn-lg"
                href={p.buttonForCodebase.href}
                target="_blank"
              >
                {p.buttonForCodebase.copy}
              </a>
            )}
          </div>
        </li>
      ))
    }
  </ul>
</section>

<script>
  const previewContainers = document.querySelectorAll(".preview-container");

  previewContainers.forEach((container) => {
    const previewImg = container.querySelector("img");
    const video = container.querySelector("video");

    container.addEventListener("mouseover", () => {
      previewImg?.classList.add("hidden");
      if (!video) return;
      video.classList.remove("hidden");
      video.currentTime = 0;
      video.play();
    });

    container.addEventListener("mouseleave", () => {
      previewImg?.classList.remove("hidden");
      video?.classList.add("hidden");
      video?.pause();
    });
  });
</script>
